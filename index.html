<!DOCTYPE html>
<html lang="fr" class="scroll-smooth"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur Imp√¥t 2025 avec PER | Calcul & Optimisation Fiscale</title>
    <meta name="description" content="Simulateur d'imp√¥t sur le revenu avec int√©gration PER. Calculez votre √©conomie fiscale, optimisez votre √©pargne retraite. Gratuit et instantan√©.">

    <!-- Canonical -->
    <link rel="canonical" href="https://salairebrutonet.com/">

    <!-- Favicon SVG -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%230284c7' rx='20' width='100' height='100'/><text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle' font-size='60'>üí∞</text></svg>">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://salairebrutonet.com/">
    <meta property="og:title" content="Simulateur Imp√¥t 2025 avec PER | Optimisation Fiscale">
    <meta property="og:description" content="Calculez votre imp√¥t et votre √©conomie gr√¢ce au PER. Simulateur gratuit et instantan√©.">
    <meta property="og:image" content="https://salairebrutonet.com/og-image.png">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:site_name" content="SalaireBrutNet">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Simulateur Imp√¥t 2025 avec PER">
    <meta name="twitter:description" content="Calculez votre imp√¥t et optimisez avec le PER. Gratuit et instantan√©.">
    <meta name="twitter:image" content="https://salairebrutonet.com/og-image.png">

    <!-- Google Search Console -->
    <meta name="google-site-verification" content="t0-U63C3ouFf4RuammFf2rR-Kxf-pn2A9aSLG2KrDNs" />

    <!-- Extra SEO -->
    <meta name="robots" content="index, follow">
    <meta name="author" content="SalaireBrutNet">
    <meta name="keywords" content="simulateur imp√¥t 2025, PER d√©duction fiscale, calcul imp√¥t France, optimisation fiscale, plan √©pargne retraite">

    <!-- Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            900: '#0c4a6e',
                        },
                        emerald: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Range slider styling */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px; width: 20px;
            border-radius: 50%;
            background: #ffffff;
            border: 2px solid #0ea5e9;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            margin-top: -8px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px;
            cursor: pointer;
            background: linear-gradient(to right, #0ea5e9 0%, #0ea5e9 var(--progress, 0%), #e2e8f0 var(--progress, 0%), #e2e8f0 100%);
            border-radius: 9999px;
        }

        /* Animations */
        .animate-in { animation: fadeSlideIn 0.3s ease-out; }
        @keyframes fadeSlideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chart-transition { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }

        /* Number input arrows hidden */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        /* Tooltip */
        .tooltip { position: relative; }
        .tooltip:hover::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 50;
            margin-bottom: 6px;
        }

        /* Mobile sticky results */
        @media (max-width: 1023px) {
            .mobile-sticky-btn {
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                z-index: 40;
            }
        }
    </style>

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "SalaireBrutNet - Simulateur Imp√¥t avec PER",
        "url": "https://salairebrutonet.com",
        "description": "Simulateur d'imp√¥t sur le revenu avec optimisation PER. Calcul instantan√© et gratuit.",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Web",
        "offers": { "@type": "Offer", "price": "0", "priceCurrency": "EUR" },
        "author": { "@type": "Organization", "name": "SalaireBrutNet" }
    }
    </script>
</head>
<body class="bg-slate-50 text-slate-600 antialiased selection:bg-brand-100 selection:text-brand-900 flex flex-col min-h-screen">

    <!-- Header -->
    <header class="sticky top-0 z-50 w-full border-b border-slate-200 bg-white/90 backdrop-blur-md">
        <div class="mx-auto flex h-16 max-w-7xl items-center justify-between px-4 sm:px-6 lg:px-8">
            <a href="/" class="flex items-center gap-2">
                <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-brand-600 text-white">
                    <i data-lucide="calculator" class="h-5 w-5"></i>
                </div>
                <span class="text-base font-semibold tracking-tight text-slate-900">SalaireBrutNet</span>
            </a>
            <nav class="hidden md:flex gap-8">
                <a href="#simulateur" class="text-sm font-medium text-slate-900">Simulateur</a>
                <a href="#how-it-works" class="text-sm font-medium text-slate-500 hover:text-slate-900 transition-colors">Comment √ßa marche</a>
                <a href="#faq" class="text-sm font-medium text-slate-500 hover:text-slate-900 transition-colors">FAQ</a>
                <a href="equipe.html" class="text-sm font-medium text-slate-500 hover:text-slate-900 transition-colors">√âquipe</a>
            </nav>
            <button id="btn-share" class="hidden sm:inline-flex items-center gap-2 rounded-lg bg-slate-900 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-slate-800 transition-colors">
                <i data-lucide="share-2" class="h-4 w-4"></i>
                Partager
            </button>
        </div>
    </header>

    <main class="flex-grow">
        <!-- Hero Section -->
        <section class="pt-12 pb-6 md:pt-20 md:pb-10 text-center px-4">
            <div class="inline-flex items-center gap-2 rounded-full bg-emerald-50 border border-emerald-200 px-4 py-1.5 mb-6">
                <i data-lucide="sparkles" class="h-4 w-4 text-emerald-600"></i>
                <span class="text-sm font-medium text-emerald-700">Nouveau : Simulation PER int√©gr√©e</span>
            </div>
            <h1 class="mx-auto max-w-4xl text-3xl font-bold tracking-tight text-slate-900 sm:text-5xl lg:text-6xl">
                Calculez <span class="text-brand-600">et optimisez</span> vos imp√¥ts
            </h1>
            <p class="mx-auto mt-6 max-w-2xl text-lg text-slate-500">
                Simulateur complet et gratuit. Estimez votre imp√¥t 2025, d√©couvrez votre √©conomie fiscale gr√¢ce au Plan d'√âpargne Retraite.
            </p>
        </section>

        <!-- Simulator Container -->
        <div id="simulateur" class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pb-20">
            <div class="grid grid-cols-1 gap-5 lg:grid-cols-12 items-start">

                    <!-- Card: Situation (Order 1 mobile) -->
                    <div class="order-1 lg:col-span-7 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-3">
                                <div class="p-2 bg-brand-50 rounded-lg text-brand-600">
                                    <i data-lucide="users" class="h-5 w-5"></i>
                                </div>
                                <h2 class="text-lg font-semibold text-slate-900">Votre situation</h2>
                            </div>
                            <div class="text-right">
                                <span class="text-xs text-slate-400">Parts fiscales</span>
                                <p class="text-lg font-bold text-brand-600" id="display-parts">1</p>
                            </div>
                        </div>

                        <!-- Statut Marital -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-slate-700 mb-3">Statut marital</label>
                            <div class="grid grid-cols-3 gap-3">
                                <label class="cursor-pointer">
                                    <input type="radio" name="status" value="single" class="peer sr-only" checked>
                                    <div class="rounded-xl border-2 border-slate-200 bg-white p-3 text-center hover:border-slate-300 peer-checked:border-brand-500 peer-checked:bg-brand-50 transition-all">
                                        <i data-lucide="user" class="h-5 w-5 mx-auto mb-1 text-slate-400 peer-checked:text-brand-600"></i>
                                        <span class="block text-sm font-medium text-slate-700">C√©libataire</span>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="status" value="married" class="peer sr-only">
                                    <div class="rounded-xl border-2 border-slate-200 bg-white p-3 text-center hover:border-slate-300 peer-checked:border-brand-500 peer-checked:bg-brand-50 transition-all">
                                        <i data-lucide="heart" class="h-5 w-5 mx-auto mb-1 text-slate-400 peer-checked:text-brand-600"></i>
                                        <span class="block text-sm font-medium text-slate-700">Mari√©/PACS</span>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="status" value="divorced" class="peer sr-only">
                                    <div class="rounded-xl border-2 border-slate-200 bg-white p-3 text-center hover:border-slate-300 peer-checked:border-brand-500 peer-checked:bg-brand-50 transition-all">
                                        <i data-lucide="user-x" class="h-5 w-5 mx-auto mb-1 text-slate-400 peer-checked:text-brand-600"></i>
                                        <span class="block text-sm font-medium text-slate-700">Divorc√©(e)</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Enfants -->
                        <div class="mb-5 flex items-center justify-between">
                            <div>
                                <label class="block text-sm font-medium text-slate-700">Enfants √† charge</label>
                                <p class="text-xs text-slate-400 mt-0.5">Mineurs ou rattach√©s au foyer</p>
                            </div>
                            <div class="flex items-center gap-3 rounded-lg border border-slate-200 bg-slate-50 p-1">
                                <button id="btn-child-minus" type="button" class="h-9 w-9 rounded-md bg-white text-slate-500 shadow-sm hover:text-brand-600 hover:bg-slate-50 flex items-center justify-center transition-all active:scale-95">
                                    <i data-lucide="minus" class="h-4 w-4"></i>
                                </button>
                                <span id="child-count" class="w-8 text-center text-xl font-bold text-slate-900">0</span>
                                <button id="btn-child-plus" type="button" class="h-9 w-9 rounded-md bg-white text-slate-500 shadow-sm hover:text-brand-600 hover:bg-slate-50 flex items-center justify-center transition-all active:scale-95">
                                    <i data-lucide="plus" class="h-4 w-4"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Parent Isol√© -->
                        <div id="parent-isole-container" class="flex items-center justify-between border-t border-slate-100 pt-4">
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-slate-700">Parent isol√©</label>
                                <span class="tooltip cursor-help" data-tip="Vous √©levez seul(e) vos enfants (case T de la d√©claration)">
                                    <i data-lucide="help-circle" class="h-4 w-4 text-slate-400"></i>
                                </span>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="parent-isole" class="sr-only peer">
                                <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-brand-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all after:shadow-sm"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Card: Revenus (Order 2 mobile) -->
                    <div class="order-2 lg:col-span-7 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="p-2 bg-brand-50 rounded-lg text-brand-600">
                                <i data-lucide="wallet" class="h-5 w-5"></i>
                            </div>
                            <h2 class="text-lg font-semibold text-slate-900">Vos revenus annuels</h2>
                        </div>

                        <!-- Ann√©e fiscale -->
                        <div class="flex gap-4 mb-6">
                            <div class="flex-1">
                                <label class="block text-xs font-medium text-slate-500 uppercase tracking-wider mb-2">Ann√©e fiscale</label>
                                <select id="select-year" class="w-full rounded-lg border border-slate-200 bg-white py-2.5 px-3 text-sm font-medium text-slate-900 focus:border-brand-500 focus:ring-2 focus:ring-brand-100 outline-none transition-all">
                                    <option value="2024">2024 (revenus 2023)</option>
                                    <option value="2025" selected>2025 (revenus 2024)</option>
                                </select>
                            </div>
                            <div class="flex-1">
                                <label class="block text-xs font-medium text-slate-500 uppercase tracking-wider mb-2">Pays</label>
                                <div class="flex items-center gap-2 rounded-lg border border-slate-200 bg-slate-50 py-2.5 px-3 text-sm font-medium text-slate-500">
                                    <span>üá´üá∑</span> France
                                </div>
                            </div>
                        </div>

                        <!-- Revenu Principal -->
                        <div class="mb-5">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-sm font-medium text-slate-700">
                                    Revenu net imposable
                                    <span class="text-slate-400 font-normal" id="label-declarant1">(vous)</span>
                                </label>
                                <div class="relative">
                                    <input type="number" id="income1-input" value="40000" min="0" max="500000" class="block w-28 text-right rounded-lg border-0 py-2 pl-3 pr-7 text-slate-900 ring-1 ring-slate-200 focus:ring-2 focus:ring-brand-500 text-sm font-semibold transition-all">
                                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm">‚Ç¨</span>
                                </div>
                            </div>
                            <input type="range" id="income1-slider" min="0" max="200000" step="500" value="40000" class="w-full h-2 rounded-lg cursor-pointer">
                            <div class="flex justify-between mt-1">
                                <span class="text-xs text-slate-400">0 ‚Ç¨</span>
                                <span class="text-xs text-slate-400">200 000 ‚Ç¨+</span>
                            </div>
                        </div>

                        <!-- Toggle 2 revenus (pour couples) -->
                        <div id="two-incomes-toggle" class="hidden mb-5 flex items-center justify-between border-t border-slate-100 pt-4">
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-slate-700">Deux revenus dans le foyer</label>
                                <span class="tooltip cursor-help" data-tip="Activez si votre conjoint a aussi des revenus">
                                    <i data-lucide="help-circle" class="h-4 w-4 text-slate-400"></i>
                                </span>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="has-two-incomes" class="sr-only peer">
                                <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-brand-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all after:shadow-sm"></div>
                            </label>
                        </div>

                        <!-- Revenu Conjoint -->
                        <div id="income2-container" class="hidden mb-5 animate-in">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-sm font-medium text-slate-700">Revenu net imposable <span class="text-slate-400 font-normal">(conjoint)</span></label>
                                <div class="relative">
                                    <input type="number" id="income2-input" value="0" min="0" max="500000" class="block w-28 text-right rounded-lg border-0 py-2 pl-3 pr-7 text-slate-900 ring-1 ring-slate-200 focus:ring-2 focus:ring-brand-500 text-sm font-semibold transition-all">
                                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm">‚Ç¨</span>
                                </div>
                            </div>
                            <input type="range" id="income2-slider" min="0" max="200000" step="500" value="0" class="w-full h-2 rounded-lg cursor-pointer">
                        </div>

                        <!-- Autres revenus -->
                        <details class="border-t border-slate-100 pt-4 group">
                            <summary class="flex cursor-pointer items-center justify-between text-sm font-medium text-brand-600 hover:text-brand-700">
                                <span class="flex items-center gap-2">
                                    <i data-lucide="plus-circle" class="h-4 w-4"></i>
                                    Autres revenus (fonciers, etc.)
                                </span>
                                <i data-lucide="chevron-down" class="h-4 w-4 transition-transform group-open:rotate-180"></i>
                            </summary>
                            <div class="mt-4 space-y-4 animate-in">
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-2">Revenus fonciers nets</label>
                                    <div class="relative">
                                        <input type="number" id="income-foncier" value="0" min="0" class="block w-full rounded-lg border-0 py-2 pl-3 pr-7 text-slate-900 ring-1 ring-slate-200 focus:ring-2 focus:ring-brand-500 text-sm transition-all">
                                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm">‚Ç¨</span>
                                    </div>
                                </div>
                            </div>
                        </details>
                    </div>

                    <!-- Card: PER (Order 4 mobile) -->
                    <div class="order-4 lg:col-span-7 rounded-2xl border-2 border-emerald-200 bg-gradient-to-br from-emerald-50 to-white p-6 shadow-sm">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-3">
                                <div class="p-2 bg-emerald-100 rounded-lg text-emerald-600">
                                    <i data-lucide="piggy-bank" class="h-5 w-5"></i>
                                </div>
                                <div>
                                    <h2 class="text-lg font-semibold text-slate-900">Plan d'√âpargne Retraite (PER)</h2>
                                    <p class="text-xs text-slate-500">D√©duisez vos versements de votre revenu imposable</p>
                                </div>
                            </div>
                            <span class="inline-flex items-center rounded-full bg-emerald-100 px-2.5 py-1 text-xs font-medium text-emerald-700">
                                Optimisation
                            </span>
                        </div>

                        <!-- Toggle PER -->
                        <div class="flex items-center justify-between mb-5">
                            <label class="text-sm font-medium text-slate-700">As-tu vers√© sur un PER cette ann√©e ?</label>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="has-per" class="sr-only peer">
                                <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-emerald-500 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all after:shadow-sm"></div>
                            </label>
                        </div>

                        <!-- PER Details (hidden by default) -->
                        <div id="per-details" class="hidden space-y-4 animate-in">
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <label class="text-sm font-medium text-slate-700">Montant vers√© sur le PER</label>
                                    <div class="relative">
                                        <input type="number" id="per-amount" value="0" min="0" class="block w-28 text-right rounded-lg border-0 py-2 pl-3 pr-7 text-slate-900 ring-1 ring-slate-200 focus:ring-2 focus:ring-emerald-500 text-sm font-semibold transition-all">
                                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm">‚Ç¨</span>
                                    </div>
                                </div>
                                <input type="range" id="per-slider" min="0" max="30000" step="100" value="0" class="w-full h-2 rounded-lg cursor-pointer">
                                <div class="flex justify-between mt-1">
                                    <span class="text-xs text-slate-400">0 ‚Ç¨</span>
                                    <span class="text-xs text-slate-400">30 000 ‚Ç¨</span>
                                </div>
                            </div>

                            <div class="flex items-center gap-2">
                                <input type="checkbox" id="per-plafond-unknown" class="rounded border-slate-300 text-emerald-600 focus:ring-emerald-500">
                                <label for="per-plafond-unknown" class="text-sm text-slate-600">Je ne connais pas mon plafond de d√©duction</label>
                            </div>

                            <div id="per-plafond-container">
                                <div class="flex justify-between items-center mb-2">
                                    <div class="flex items-center gap-2">
                                        <label class="text-sm font-medium text-slate-700">Plafond de d√©duction disponible</label>
                                        <span class="tooltip cursor-help" data-tip="Visible sur votre dernier avis d'imposition">
                                            <i data-lucide="help-circle" class="h-4 w-4 text-slate-400"></i>
                                        </span>
                                    </div>
                                    <div class="relative">
                                        <input type="number" id="per-plafond" value="0" min="0" class="block w-28 text-right rounded-lg border-0 py-2 pl-3 pr-7 text-slate-900 ring-1 ring-slate-200 focus:ring-2 focus:ring-emerald-500 text-sm font-semibold transition-all">
                                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm">‚Ç¨</span>
                                    </div>
                                </div>
                            </div>

                            <!-- PER Summary -->
                            <div class="rounded-xl bg-white border border-emerald-200 p-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-600">D√©duction retenue</span>
                                    <span class="text-sm font-bold text-emerald-600" id="per-deduction-display">0 ‚Ç¨</span>
                                </div>
                                <div class="flex justify-between items-center mt-2 pt-2 border-t border-slate-100">
                                    <span class="text-sm text-slate-600">Revenu imposable apr√®s PER</span>
                                    <span class="text-sm font-bold text-slate-900" id="income-after-per-display">0 ‚Ç¨</span>
                                </div>
                            </div>

                            <div id="per-warning" class="hidden rounded-lg bg-amber-50 border border-amber-200 p-3 text-sm text-amber-800">
                                <div class="flex gap-2">
                                    <i data-lucide="alert-triangle" class="h-4 w-4 text-amber-500 flex-shrink-0 mt-0.5"></i>
                                    <span>Plafond non renseign√© : la d√©duction est estim√©e au montant vers√©. V√©rifiez votre plafond sur votre avis d'imposition.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Card: Dons et R√©ductions (Order 5 mobile) -->
                    <div class="order-5 lg:col-span-7 rounded-2xl border-2 border-violet-200 bg-gradient-to-br from-violet-50 to-white p-6 shadow-sm">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-3">
                                <div class="p-2 bg-violet-100 rounded-lg text-violet-600">
                                    <i data-lucide="heart-handshake" class="h-5 w-5"></i>
                                </div>
                                <div>
                                    <h2 class="text-lg font-semibold text-slate-900">Dons & R√©ductions d'imp√¥t</h2>
                                    <p class="text-xs text-slate-500">R√©duisez directement votre imp√¥t (66% √† 75%)</p>
                                </div>
                            </div>
                            <span class="inline-flex items-center rounded-full bg-violet-100 px-2.5 py-1 text-xs font-medium text-violet-700">
                                R√©duction
                            </span>
                        </div>

                        <!-- Toggle Dons -->
                        <div class="flex items-center justify-between mb-5">
                            <label class="text-sm font-medium text-slate-700">As-tu fait des dons cette ann√©e ?</label>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="has-dons" class="sr-only peer">
                                <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-violet-500 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all after:shadow-sm"></div>
                            </label>
                        </div>

                        <!-- Dons Details -->
                        <div id="dons-details" class="hidden space-y-4 animate-in">
                            <!-- Dons 66% -->
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <div class="flex items-center gap-2">
                                        <label class="text-sm font-medium text-slate-700">Dons associations (66%)</label>
                                        <span class="tooltip cursor-help" data-tip="Associations d'int√©r√™t g√©n√©ral, fondations, partis politiques...">
                                            <i data-lucide="help-circle" class="h-4 w-4 text-slate-400"></i>
                                        </span>
                                    </div>
                                    <div class="relative">
                                        <input type="number" id="dons-66" value="0" min="0" class="block w-28 text-right rounded-lg border-0 py-2 pl-3 pr-7 text-slate-900 ring-1 ring-slate-200 focus:ring-2 focus:ring-violet-500 text-sm font-semibold transition-all">
                                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm">‚Ç¨</span>
                                    </div>
                                </div>
                                <input type="range" id="dons-66-slider" min="0" max="10000" step="50" value="0" class="w-full h-2 rounded-lg cursor-pointer">
                            </div>

                            <!-- Dons 75% -->
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <div class="flex items-center gap-2">
                                        <label class="text-sm font-medium text-slate-700">Dons aide aux personnes (75%)</label>
                                        <span class="tooltip cursor-help" data-tip="Restos du C≈ìur, Secours Populaire, Croix-Rouge... (plafonn√© √† 1000‚Ç¨)">
                                            <i data-lucide="help-circle" class="h-4 w-4 text-slate-400"></i>
                                        </span>
                                    </div>
                                    <div class="relative">
                                        <input type="number" id="dons-75" value="0" min="0" class="block w-28 text-right rounded-lg border-0 py-2 pl-3 pr-7 text-slate-900 ring-1 ring-slate-200 focus:ring-2 focus:ring-violet-500 text-sm font-semibold transition-all">
                                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm">‚Ç¨</span>
                                    </div>
                                </div>
                                <input type="range" id="dons-75-slider" min="0" max="2000" step="50" value="0" class="w-full h-2 rounded-lg cursor-pointer">
                                <p class="text-xs text-slate-400 mt-1">75% jusqu'√† 1000‚Ç¨, puis 66% au-del√†</p>
                            </div>

                            <!-- Dons Summary -->
                            <div class="rounded-xl bg-white border border-violet-200 p-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-600">Total des dons</span>
                                    <span class="text-sm font-bold text-slate-900" id="dons-total-display">0 ‚Ç¨</span>
                                </div>
                                <div class="flex justify-between items-center mt-2 pt-2 border-t border-slate-100">
                                    <span class="text-sm text-slate-600">R√©duction d'imp√¥t</span>
                                    <span class="text-sm font-bold text-violet-600" id="dons-reduction-display">0 ‚Ç¨</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Actions (Order 6 mobile) -->
                    <div class="order-6 lg:col-span-7 flex items-center justify-between pt-2">
                        <button id="btn-reset" type="button" class="text-sm text-slate-500 hover:text-slate-900 flex items-center gap-1.5 transition-colors">
                            <i data-lucide="rotate-ccw" class="h-4 w-4"></i> R√©initialiser
                        </button>
                        <span class="text-xs text-slate-400">Bar√®me 2025 ¬∑ Mis √† jour en janvier 2025</span>
                    </div>

                <!-- Results Column (Order 3 mobile, sticky right on desktop) -->
                <div class="order-3 lg:col-span-5 lg:row-span-6 lg:row-start-1 lg:col-start-8 relative">
                    <div class="lg:sticky lg:top-24 space-y-5">

                        <!-- Main Result Card -->
                        <div class="rounded-2xl bg-gradient-to-br from-slate-900 to-slate-800 text-white p-6 shadow-xl overflow-hidden relative">
                            <div class="absolute top-0 right-0 -mt-8 -mr-8 h-32 w-32 rounded-full bg-brand-500 opacity-20 blur-2xl"></div>
                            <div class="absolute bottom-0 left-0 -mb-8 -ml-8 h-24 w-24 rounded-full bg-emerald-500 opacity-10 blur-xl"></div>

                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-slate-400 uppercase tracking-wider">Estimation imp√¥t <span id="result-year">2025</span></h3>
                                <span class="inline-flex items-center rounded-full bg-white/10 px-2.5 py-1 text-xs font-medium text-white/80">
                                    <i data-lucide="zap" class="h-3 w-3 mr-1"></i> Temps r√©el
                                </span>
                            </div>

                            <div class="flex items-end gap-2 mb-1">
                                <span class="text-5xl font-bold tracking-tight" id="result-tax">0 ‚Ç¨</span>
                            </div>
                            <p class="text-sm text-slate-400 mb-4">Imp√¥t sur le revenu estim√©</p>

                            <div class="h-1.5 w-full bg-slate-700 rounded-full mb-6 overflow-hidden">
                                <div id="tax-progress-bar" class="h-full bg-gradient-to-r from-brand-400 to-brand-500 chart-transition rounded-full" style="width: 0%"></div>
                            </div>

                            <div class="grid grid-cols-2 gap-4 border-t border-slate-700/50 pt-4">
                                <div>
                                    <p class="text-xs text-slate-400 mb-1">Taux moyen</p>
                                    <p class="text-2xl font-bold text-brand-400" id="result-avg-rate">0%</p>
                                </div>
                                <div>
                                    <p class="text-xs text-slate-400 mb-1">Taux marginal</p>
                                    <p class="text-2xl font-bold text-white" id="result-marginal-rate">0%</p>
                                </div>
                            </div>
                        </div>

                        <!-- Savings Cards Container -->
                        <div class="space-y-3">
                            <!-- PER Savings Card -->
                            <div id="per-savings-card" class="hidden rounded-2xl bg-gradient-to-br from-emerald-500 to-emerald-600 text-white p-5 shadow-lg animate-in">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-emerald-100 mb-1">√âconomie gr√¢ce au PER</p>
                                        <p class="text-3xl font-bold" id="result-per-savings">0 ‚Ç¨</p>
                                    </div>
                                    <div class="h-14 w-14 rounded-full bg-white/20 flex items-center justify-center">
                                        <i data-lucide="piggy-bank" class="h-7 w-7"></i>
                                    </div>
                                </div>
                                <p class="text-sm text-emerald-100 mt-3" id="per-savings-explanation">
                                    Chaque ‚Ç¨ vers√© r√©duit votre imp√¥t de <span id="per-efficiency">0</span> centimes.
                                </p>
                            </div>

                            <!-- Dons Savings Card -->
                            <div id="dons-savings-card" class="hidden rounded-2xl bg-gradient-to-br from-violet-500 to-violet-600 text-white p-5 shadow-lg animate-in">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-violet-100 mb-1">R√©duction gr√¢ce aux dons</p>
                                        <p class="text-3xl font-bold" id="result-dons-savings">0 ‚Ç¨</p>
                                    </div>
                                    <div class="h-14 w-14 rounded-full bg-white/20 flex items-center justify-center">
                                        <i data-lucide="heart" class="h-7 w-7"></i>
                                    </div>
                                </div>
                                <p class="text-sm text-violet-100 mt-3">
                                    Vos dons de <span id="dons-total-result">0 ‚Ç¨</span> r√©duisent directement votre imp√¥t.
                                </p>
                            </div>
                        </div>

                        <!-- Net Result Card -->
                        <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
                            <h3 class="text-sm font-semibold text-slate-900 mb-4">Votre reste √† vivre</h3>

                            <div class="flex items-center gap-6 mb-6">
                                <!-- Donut Chart -->
                                <div class="relative h-28 w-28 flex-shrink-0">
                                    <div id="chart-donut" class="absolute inset-0 rounded-full chart-transition" style="background: conic-gradient(#0ea5e9 0% 10%, #f1f5f9 10% 100%);"></div>
                                    <div class="absolute inset-3 rounded-full bg-white flex items-center justify-center flex-col shadow-inner">
                                        <span class="text-xs text-slate-400">Net</span>
                                        <span id="chart-percent" class="text-lg font-bold text-slate-900">90%</span>
                                    </div>
                                </div>

                                <div class="flex-grow space-y-3">
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center gap-2">
                                            <span class="h-3 w-3 rounded-full bg-slate-200"></span>
                                            <span class="text-sm text-slate-600">Revenu net annuel</span>
                                        </div>
                                        <span class="text-sm font-semibold text-slate-900" id="result-net-annual">0 ‚Ç¨</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center gap-2">
                                            <span class="h-3 w-3 rounded-full bg-brand-500"></span>
                                            <span class="text-sm text-slate-600">Imp√¥t</span>
                                        </div>
                                        <span class="text-sm font-medium text-slate-500" id="result-tax-small">- 0 ‚Ç¨</span>
                                    </div>
                                    <div class="pt-2 border-t border-slate-100">
                                        <div class="flex justify-between items-baseline">
                                            <span class="text-sm font-medium text-slate-900">Mensuel net</span>
                                            <span class="text-xl font-bold text-brand-600" id="result-monthly">0 ‚Ç¨</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Calculation Details -->
                            <details class="group">
                                <summary class="flex cursor-pointer items-center justify-between rounded-lg bg-slate-50 p-3 text-sm font-medium text-slate-700 hover:bg-slate-100 transition-colors">
                                    <span class="flex items-center gap-2">
                                        <i data-lucide="file-text" class="h-4 w-4"></i>
                                        D√©tails du calcul
                                    </span>
                                    <i data-lucide="chevron-down" class="h-4 w-4 transition-transform group-open:rotate-180"></i>
                                </summary>
                                <div class="mt-3 px-1 text-sm text-slate-600 space-y-2" id="calc-details">
                                    <div class="flex justify-between py-1.5 border-b border-slate-100">
                                        <span>Revenu brut du foyer</span>
                                        <span class="font-medium text-slate-900" id="detail-gross">0 ‚Ç¨</span>
                                    </div>
                                    <div class="flex justify-between py-1.5 border-b border-slate-100">
                                        <span>Abattement 10%</span>
                                        <span class="font-medium text-slate-900" id="detail-abattement">- 0 ‚Ç¨</span>
                                    </div>
                                    <div id="detail-per-row" class="hidden flex justify-between py-1.5 border-b border-slate-100">
                                        <span>D√©duction PER</span>
                                        <span class="font-medium text-emerald-600" id="detail-per">- 0 ‚Ç¨</span>
                                    </div>
                                    <div class="flex justify-between py-1.5 border-b border-slate-100">
                                        <span>Revenu imposable</span>
                                        <span class="font-medium text-slate-900" id="detail-taxable">0 ‚Ç¨</span>
                                    </div>
                                    <div id="detail-dons-row" class="hidden flex justify-between py-1.5 border-b border-slate-100">
                                        <span>R√©duction dons</span>
                                        <span class="font-medium text-violet-600" id="detail-dons">- 0 ‚Ç¨</span>
                                    </div>
                                    <div class="flex justify-between py-1.5 border-b border-slate-100">
                                        <span>Nombre de parts</span>
                                        <span class="font-medium text-slate-900" id="detail-parts">1</span>
                                    </div>
                                    <div class="flex justify-between py-1.5 border-b border-slate-100">
                                        <span>Quotient familial</span>
                                        <span class="font-medium text-slate-900" id="detail-qf">0 ‚Ç¨</span>
                                    </div>
                                    <div class="mt-3 p-3 bg-slate-50 rounded-lg overflow-x-auto">
                                        <p class="text-xs font-medium text-slate-700 mb-3">Tranches appliqu√©es (par part) :</p>
                                        <table class="w-full text-xs">
                                            <thead>
                                                <tr class="text-left text-slate-500 border-b border-slate-200">
                                                    <th class="pb-2 font-medium">Tranche</th>
                                                    <th class="pb-2 font-medium text-right">Montant</th>
                                                    <th class="pb-2 font-medium text-right">Taux</th>
                                                    <th class="pb-2 font-medium text-right">Imp√¥t</th>
                                                </tr>
                                            </thead>
                                            <tbody id="detail-tranches" class="text-slate-600"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </details>
                        </div>

                        <!-- Tips Card -->
                        <div class="rounded-xl bg-gradient-to-br from-indigo-50 to-white border border-indigo-100 p-4">
                            <div class="flex gap-3">
                                <div class="text-indigo-600 mt-0.5"><i data-lucide="lightbulb" class="h-5 w-5"></i></div>
                                <div>
                                    <h4 class="text-sm font-semibold text-indigo-900">Conseil personnalis√©</h4>
                                    <p class="text-sm text-indigo-700 mt-1 leading-relaxed" id="dynamic-tip">
                                        Analysez votre situation pour obtenir un conseil adapt√©.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Disclaimer -->
                        <div class="text-center text-xs text-slate-400 px-4">
                            <i data-lucide="info" class="h-3 w-3 inline mr-1"></i>
                            Estimation indicative bas√©e sur le bar√®me officiel. Ne remplace pas l'avis de l'administration fiscale.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section: How it works -->
        <section id="how-it-works" class="bg-white border-t border-slate-200 py-16">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold tracking-tight text-slate-900">Comment √ßa marche ?</h2>
                    <p class="mt-3 text-slate-500">En 3 √©tapes simples</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="flex flex-col items-center text-center">
                        <div class="flex h-14 w-14 items-center justify-center rounded-2xl bg-brand-100 text-brand-700 mb-4 font-bold text-xl">1</div>
                        <h3 class="text-lg font-semibold text-slate-900 mb-2">Renseignez votre profil</h3>
                        <p class="text-slate-500 text-sm">Situation familiale, revenus annuels, versements PER...</p>
                    </div>
                    <div class="flex flex-col items-center text-center">
                        <div class="flex h-14 w-14 items-center justify-center rounded-2xl bg-emerald-100 text-emerald-700 mb-4 font-bold text-xl">2</div>
                        <h3 class="text-lg font-semibold text-slate-900 mb-2">Calcul instantan√©</h3>
                        <p class="text-slate-500 text-sm">Bar√®me progressif, quotient familial, d√©ductions PER appliqu√©s automatiquement.</p>
                    </div>
                    <div class="flex flex-col items-center text-center">
                        <div class="flex h-14 w-14 items-center justify-center rounded-2xl bg-indigo-100 text-indigo-700 mb-4 font-bold text-xl">3</div>
                        <h3 class="text-lg font-semibold text-slate-900 mb-2">Optimisez</h3>
                        <p class="text-slate-500 text-sm">Visualisez l'impact de chaque levier fiscal et partagez votre simulation.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section id="faq" class="py-16 bg-slate-50">
            <div class="mx-auto max-w-3xl px-4">
                <h2 class="text-2xl font-bold tracking-tight text-slate-900 mb-8 text-center">Questions fr√©quentes</h2>
                <div class="space-y-4">
                    <details class="group rounded-xl bg-white border border-slate-200 p-4 open:ring-1 open:ring-brand-500 open:border-brand-500">
                        <summary class="flex cursor-pointer items-center justify-between font-medium text-slate-900">
                            Comment fonctionne la d√©duction PER ?
                            <i data-lucide="chevron-down" class="h-4 w-4 transition-transform group-open:rotate-180"></i>
                        </summary>
                        <p class="mt-3 text-sm text-slate-600 leading-relaxed">
                            Les versements sur un PER (Plan d'√âpargne Retraite) sont d√©ductibles de votre revenu imposable, dans la limite d'un plafond annuel. Ce plafond est indiqu√© sur votre avis d'imposition. Plus votre taux marginal est √©lev√©, plus l'√©conomie d'imp√¥t est importante.
                        </p>
                    </details>
                    <details class="group rounded-xl bg-white border border-slate-200 p-4">
                        <summary class="flex cursor-pointer items-center justify-between font-medium text-slate-900">
                            O√π trouver mon plafond de d√©duction PER ?
                            <i data-lucide="chevron-down" class="h-4 w-4 transition-transform group-open:rotate-180"></i>
                        </summary>
                        <p class="mt-3 text-sm text-slate-600 leading-relaxed">
                            Votre plafond de d√©duction est indiqu√© sur votre dernier avis d'imposition, dans la rubrique "Plafond √©pargne retraite". Il correspond √† 10% de vos revenus professionnels de l'ann√©e pr√©c√©dente, avec un minimum et un maximum fix√©s par la loi.
                        </p>
                    </details>
                    <details class="group rounded-xl bg-white border border-slate-200 p-4">
                        <summary class="flex cursor-pointer items-center justify-between font-medium text-slate-900">
                            Le r√©sultat est-il garanti ?
                            <i data-lucide="chevron-down" class="h-4 w-4 transition-transform group-open:rotate-180"></i>
                        </summary>
                        <p class="mt-3 text-sm text-slate-600 leading-relaxed">
                            Non, il s'agit d'une estimation bas√©e sur le bar√®me g√©n√©ral. Certains cr√©dits d'imp√¥ts, r√©ductions sp√©cifiques ou situations complexes ne sont pas pris en compte. Pour une simulation officielle, consultez le site impots.gouv.fr.
                        </p>
                    </details>
                    <details class="group rounded-xl bg-white border border-slate-200 p-4">
                        <summary class="flex cursor-pointer items-center justify-between font-medium text-slate-900">
                            Comment sont calcul√©es les parts fiscales ?
                            <i data-lucide="chevron-down" class="h-4 w-4 transition-transform group-open:rotate-180"></i>
                        </summary>
                        <p class="mt-3 text-sm text-slate-600 leading-relaxed">
                            C√©libataire = 1 part, Couple mari√©/PACS = 2 parts. Les 2 premiers enfants ajoutent 0,5 part chacun, les suivants 1 part. Le statut de parent isol√© ajoute 0,5 part suppl√©mentaire.
                        </p>
                    </details>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 py-10">
        <div class="mx-auto max-w-7xl px-4 flex flex-col md:flex-row justify-between items-center gap-6">
            <a href="/" class="flex items-center gap-2">
                <div class="flex h-6 w-6 items-center justify-center rounded bg-slate-900 text-white">
                    <i data-lucide="calculator" class="h-3 w-3"></i>
                </div>
                <span class="text-sm font-semibold text-slate-900">SalaireBrutNet</span>
            </a>
            <p class="text-xs text-slate-500">¬© 2025 SalaireBrutNet ¬∑ Estimation indicative ¬∑ Ne remplace pas l'avis de la DGFiP</p>
            <div class="flex gap-4">
                <a href="mentions-legales.html" class="text-xs text-slate-500 hover:text-slate-900">Mentions l√©gales</a>
                <a href="equipe.html" class="text-xs text-slate-500 hover:text-slate-900">√âquipe</a>
            </div>
        </div>
    </footer>

    <!-- Mobile Sticky Button -->
    <button id="mobile-results-btn" class="lg:hidden mobile-sticky-btn inline-flex items-center gap-2 rounded-full bg-brand-600 px-6 py-3 text-sm font-semibold text-white shadow-lg hover:bg-brand-700 transition-all">
        <i data-lucide="calculator" class="h-4 w-4"></i>
        Voir mes r√©sultats
    </button>

    <!-- Share Modal -->
    <div id="share-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full shadow-xl">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-slate-900">Partager cette simulation</h3>
                <button id="close-modal" class="text-slate-400 hover:text-slate-600">
                    <i data-lucide="x" class="h-5 w-5"></i>
                </button>
            </div>
            <p class="text-sm text-slate-500 mb-4">Copiez ce lien pour partager votre simulation avec les m√™mes param√®tres :</p>
            <div class="flex gap-2">
                <input type="text" id="share-url" readonly class="flex-1 rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-600 bg-slate-50">
                <button id="copy-url" class="rounded-lg bg-brand-600 px-4 py-2 text-sm font-medium text-white hover:bg-brand-700 transition-colors">
                    Copier
                </button>
            </div>
            <p id="copy-success" class="hidden text-sm text-emerald-600 mt-2">Lien copi√© !</p>
        </div>
    </div>

    <!-- Calculator Engine -->
    <script>
    (function() {
        'use strict';

        // ============================================
        // CONFIGURATION - Bar√®mes param√©trables
        // ============================================
        const TAX_BRACKETS = {
            2024: [
                { limit: 11294, rate: 0 },
                { limit: 28797, rate: 0.11 },
                { limit: 82341, rate: 0.30 },
                { limit: 177106, rate: 0.41 },
                { limit: Infinity, rate: 0.45 }
            ],
            2025: [
                { limit: 11497, rate: 0 },
                { limit: 29315, rate: 0.11 },
                { limit: 83823, rate: 0.30 },
                { limit: 180294, rate: 0.41 },
                { limit: Infinity, rate: 0.45 }
            ]
        };

        const ABATTEMENT_RATE = 0.10;
        const ABATTEMENT_MAX = 14171;
        const ABATTEMENT_MIN = 495;

        // ============================================
        // STATE
        // ============================================
        const state = {
            status: 'single',
            children: 0,
            parentIsole: false,
            income1: 40000,
            income2: 0,
            hasTwoIncomes: false,
            incomeFoncier: 0,
            year: 2025,
            hasPer: false,
            perAmount: 0,
            perPlafond: 0,
            perPlafondUnknown: false,
            hasDons: false,
            dons66: 0,
            dons75: 0
        };

        // ============================================
        // DOM ELEMENTS
        // ============================================
        const $ = (sel) => document.querySelector(sel);
        const $$ = (sel) => document.querySelectorAll(sel);

        const els = {
            // Inputs
            statusRadios: $$('input[name="status"]'),
            childCount: $('#child-count'),
            btnChildMinus: $('#btn-child-minus'),
            btnChildPlus: $('#btn-child-plus'),
            parentIsoleContainer: $('#parent-isole-container'),
            parentIsole: $('#parent-isole'),
            selectYear: $('#select-year'),
            income1Input: $('#income1-input'),
            income1Slider: $('#income1-slider'),
            twoIncomesToggle: $('#two-incomes-toggle'),
            hasTwoIncomes: $('#has-two-incomes'),
            income2Container: $('#income2-container'),
            income2Input: $('#income2-input'),
            income2Slider: $('#income2-slider'),
            incomeFoncier: $('#income-foncier'),
            hasPer: $('#has-per'),
            perDetails: $('#per-details'),
            perAmount: $('#per-amount'),
            perSlider: $('#per-slider'),
            perPlafond: $('#per-plafond'),
            perPlafondUnknown: $('#per-plafond-unknown'),
            perPlafondContainer: $('#per-plafond-container'),
            perWarning: $('#per-warning'),
            hasDons: $('#has-dons'),
            donsDetails: $('#dons-details'),
            dons66: $('#dons-66'),
            dons66Slider: $('#dons-66-slider'),
            dons75: $('#dons-75'),
            dons75Slider: $('#dons-75-slider'),
            donsTotalDisplay: $('#dons-total-display'),
            donsReductionDisplay: $('#dons-reduction-display'),
            btnReset: $('#btn-reset'),
            btnShare: $('#btn-share'),

            // Displays
            displayParts: $('#display-parts'),
            perDeductionDisplay: $('#per-deduction-display'),
            incomeAfterPerDisplay: $('#income-after-per-display'),

            // Results
            resultYear: $('#result-year'),
            resultTax: $('#result-tax'),
            resultAvgRate: $('#result-avg-rate'),
            resultMarginalRate: $('#result-marginal-rate'),
            taxProgressBar: $('#tax-progress-bar'),
            perSavingsCard: $('#per-savings-card'),
            resultPerSavings: $('#result-per-savings'),
            perEfficiency: $('#per-efficiency'),
            donsSavingsCard: $('#dons-savings-card'),
            resultDonsSavings: $('#result-dons-savings'),
            donsTotalResult: $('#dons-total-result'),
            chartDonut: $('#chart-donut'),
            chartPercent: $('#chart-percent'),
            resultNetAnnual: $('#result-net-annual'),
            resultTaxSmall: $('#result-tax-small'),
            resultMonthly: $('#result-monthly'),
            dynamicTip: $('#dynamic-tip'),

            // Details
            detailGross: $('#detail-gross'),
            detailAbattement: $('#detail-abattement'),
            detailPerRow: $('#detail-per-row'),
            detailPer: $('#detail-per'),
            detailTaxable: $('#detail-taxable'),
            detailDonsRow: $('#detail-dons-row'),
            detailDons: $('#detail-dons'),
            detailParts: $('#detail-parts'),
            detailQf: $('#detail-qf'),
            detailTranches: $('#detail-tranches'),

            // Modal
            shareModal: $('#share-modal'),
            shareUrl: $('#share-url'),
            copyUrl: $('#copy-url'),
            copySuccess: $('#copy-success'),
            closeModal: $('#close-modal'),

            // Mobile
            mobileResultsBtn: $('#mobile-results-btn')
        };

        // ============================================
        // UTILITIES
        // ============================================
        const formatMoney = (val) => new Intl.NumberFormat('fr-FR', {
            style: 'currency',
            currency: 'EUR',
            maximumFractionDigits: 0
        }).format(val);

        const formatPercent = (val) => val.toFixed(1) + '%';

        const clamp = (val, min, max) => Math.min(Math.max(val, min), max);

        // ============================================
        // CALCULATION ENGINE
        // ============================================
        function calculateParts() {
            let parts = state.status === 'married' ? 2 : 1;

            // Children: 0.5 for first two, 1 for each additional
            if (state.children >= 1) parts += 0.5;
            if (state.children >= 2) parts += 0.5;
            if (state.children >= 3) parts += (state.children - 2);

            // Parent isol√©: +0.5 if single/divorced with children
            if (state.parentIsole && state.children > 0 && state.status !== 'married') {
                parts += 0.5;
            }

            return parts;
        }

        function calculateAbattement(income) {
            const abattement = income * ABATTEMENT_RATE;
            return clamp(abattement, income > 0 ? ABATTEMENT_MIN : 0, ABATTEMENT_MAX);
        }

        function calculateTax(taxableIncome, parts, brackets) {
            const qf = taxableIncome / parts;
            let taxPerPart = 0;
            let marginalRate = 0;
            const tranchesApplied = [];

            for (let i = 0; i < brackets.length; i++) {
                const bracket = brackets[i];
                const prevLimit = i === 0 ? 0 : brackets[i - 1].limit;

                // Calculate amount in this bracket
                let amountInBracket = 0;
                let taxInBracket = 0;

                if (qf > prevLimit) {
                    amountInBracket = Math.min(qf, bracket.limit) - prevLimit;
                    taxInBracket = amountInBracket * bracket.rate;
                    taxPerPart += taxInBracket;
                    marginalRate = bracket.rate;
                }

                // Add all tranches to show complete picture
                tranchesApplied.push({
                    from: prevLimit,
                    to: bracket.limit,
                    rate: bracket.rate,
                    amount: amountInBracket,
                    tax: taxInBracket
                });
            }

            return {
                tax: Math.floor(taxPerPart * parts),
                marginalRate,
                qf,
                tranchesApplied
            };
        }

        function calculate() {
            const brackets = TAX_BRACKETS[state.year] || TAX_BRACKETS[2025];
            const parts = calculateParts();

            // Total gross income
            let grossIncome = state.income1 + state.incomeFoncier;
            if (state.status === 'married' && state.hasTwoIncomes) {
                grossIncome += state.income2;
            }

            // Abattement 10%
            let totalAbattement = calculateAbattement(state.income1);
            if (state.status === 'married' && state.hasTwoIncomes) {
                totalAbattement += calculateAbattement(state.income2);
            }

            // PER deduction
            let perDeduction = 0;
            if (state.hasPer && state.perAmount > 0) {
                if (state.perPlafondUnknown || state.perPlafond === 0) {
                    perDeduction = state.perAmount;
                } else {
                    perDeduction = Math.min(state.perAmount, state.perPlafond);
                }
            }

            // Taxable income
            const incomeAfterAbattement = Math.max(0, grossIncome - totalAbattement);
            const taxableIncome = Math.max(0, incomeAfterAbattement - perDeduction);

            // Calculate tax WITH PER
            const result = calculateTax(taxableIncome, parts, brackets);

            // Calculate tax WITHOUT PER (for comparison)
            const resultWithoutPer = calculateTax(incomeAfterAbattement, parts, brackets);
            const perSavings = resultWithoutPer.tax - result.tax;

            // Calculate donation reduction
            let donsReduction = 0;
            let donsTotal = 0;
            if (state.hasDons) {
                donsTotal = state.dons66 + state.dons75;
                // 75% reduction for dons75 up to 1000‚Ç¨, then 66%
                const dons75Capped = Math.min(state.dons75, 1000);
                const dons75Excess = Math.max(0, state.dons75 - 1000);
                donsReduction = Math.floor(
                    (state.dons66 * 0.66) +
                    (dons75Capped * 0.75) +
                    (dons75Excess * 0.66)
                );
                // Cap at 20% of taxable income (simplified)
                const maxDonsReduction = Math.floor(taxableIncome * 0.20);
                donsReduction = Math.min(donsReduction, maxDonsReduction);
            }

            // Final tax after dons reduction
            const finalTax = Math.max(0, result.tax - donsReduction);

            // Net after tax
            const netAfterTax = grossIncome - finalTax;
            const monthly = netAfterTax / 12;
            const avgRate = grossIncome > 0 ? (finalTax / grossIncome) * 100 : 0;
            const taxPercent = grossIncome > 0 ? (finalTax / grossIncome) * 100 : 0;

            // Update UI
            updateUI({
                parts,
                grossIncome,
                totalAbattement,
                perDeduction,
                incomeAfterAbattement,
                taxableIncome,
                tax: finalTax,
                taxBeforeDons: result.tax,
                marginalRate: result.marginalRate,
                qf: result.qf,
                tranchesApplied: result.tranchesApplied,
                netAfterTax,
                monthly,
                avgRate,
                taxPercent,
                perSavings,
                donsTotal,
                donsReduction
            });

            // Update URL
            updateURL();
        }

        function updateUI(data) {
            // Parts display
            els.displayParts.textContent = data.parts;

            // PER displays
            if (state.hasPer) {
                els.perDeductionDisplay.textContent = formatMoney(data.perDeduction);
                els.incomeAfterPerDisplay.textContent = formatMoney(data.taxableIncome);

                // Warning if plafond unknown
                if (state.perPlafondUnknown || state.perPlafond === 0) {
                    els.perWarning.classList.remove('hidden');
                } else {
                    els.perWarning.classList.add('hidden');
                }
            }

            // Main results
            els.resultYear.textContent = state.year;
            els.resultTax.textContent = formatMoney(data.tax);
            els.resultAvgRate.textContent = formatPercent(data.avgRate);
            els.resultMarginalRate.textContent = (data.marginalRate * 100).toFixed(0) + '%';
            els.taxProgressBar.style.width = Math.min(data.avgRate * 2.5, 100) + '%';

            // PER savings card
            if (state.hasPer && data.perSavings > 0) {
                els.perSavingsCard.classList.remove('hidden');
                els.resultPerSavings.textContent = formatMoney(data.perSavings);
                const efficiency = data.perDeduction > 0 ? Math.round((data.perSavings / data.perDeduction) * 100) : 0;
                els.perEfficiency.textContent = efficiency;
            } else {
                els.perSavingsCard.classList.add('hidden');
            }

            // Dons savings card
            if (state.hasDons && data.donsReduction > 0) {
                els.donsSavingsCard.classList.remove('hidden');
                els.resultDonsSavings.textContent = formatMoney(data.donsReduction);
                els.donsTotalResult.textContent = formatMoney(data.donsTotal);
            } else {
                els.donsSavingsCard.classList.add('hidden');
            }

            // Dons display in form
            if (state.hasDons) {
                els.donsTotalDisplay.textContent = formatMoney(data.donsTotal);
                els.donsReductionDisplay.textContent = formatMoney(data.donsReduction);
            }

            // Net results
            els.chartPercent.textContent = (100 - data.taxPercent).toFixed(0) + '%';
            els.chartDonut.style.background = `conic-gradient(#0ea5e9 0% ${data.taxPercent}%, #f1f5f9 ${data.taxPercent}% 100%)`;
            els.resultNetAnnual.textContent = formatMoney(data.netAfterTax);
            els.resultTaxSmall.textContent = '- ' + formatMoney(data.tax);
            els.resultMonthly.textContent = formatMoney(data.monthly);

            // Details
            els.detailGross.textContent = formatMoney(data.grossIncome);
            els.detailAbattement.textContent = '- ' + formatMoney(data.totalAbattement);

            if (state.hasPer && data.perDeduction > 0) {
                els.detailPerRow.classList.remove('hidden');
                els.detailPer.textContent = '- ' + formatMoney(data.perDeduction);
            } else {
                els.detailPerRow.classList.add('hidden');
            }

            els.detailTaxable.textContent = formatMoney(data.taxableIncome);

            if (state.hasDons && data.donsReduction > 0) {
                els.detailDonsRow.classList.remove('hidden');
                els.detailDons.textContent = '- ' + formatMoney(data.donsReduction);
            } else {
                els.detailDonsRow.classList.add('hidden');
            }

            els.detailParts.textContent = data.parts;
            els.detailQf.textContent = formatMoney(data.qf);

            // Tranches - table format
            els.detailTranches.innerHTML = data.tranchesApplied.map((t, i) => {
                const isActive = t.amount > 0;
                const rowClass = isActive ? 'text-slate-900 font-medium' : 'text-slate-400';
                const bgClass = isActive ? 'bg-brand-50/50' : '';

                // Format tranche label
                let trancheLabel;
                if (i === 0) {
                    trancheLabel = `Jusqu'√† ${formatMoney(t.to)}`;
                } else if (t.to === Infinity) {
                    trancheLabel = `Au-del√† de ${formatMoney(t.from)}`;
                } else {
                    trancheLabel = `De ${formatMoney(t.from + 1)} √† ${formatMoney(t.to)}`;
                }

                return `
                    <tr class="${bgClass}">
                        <td class="py-1.5 pr-2 ${rowClass}">${trancheLabel}</td>
                        <td class="py-1.5 text-right ${rowClass}">${formatMoney(t.amount)}</td>
                        <td class="py-1.5 text-right ${rowClass}">${(t.rate * 100).toFixed(0)}%</td>
                        <td class="py-1.5 text-right ${isActive ? 'text-brand-600 font-semibold' : 'text-slate-400'}">${formatMoney(t.tax)}</td>
                    </tr>
                `;
            }).join('') + `
                <tr class="border-t border-slate-200 font-semibold text-slate-900">
                    <td class="pt-2">Total par part</td>
                    <td class="pt-2 text-right">${formatMoney(data.qf)}</td>
                    <td class="pt-2 text-right"></td>
                    <td class="pt-2 text-right text-brand-600">${formatMoney(data.tranchesApplied.reduce((sum, t) => sum + t.tax, 0))}</td>
                </tr>
                <tr class="font-semibold text-slate-900 bg-slate-100">
                    <td class="py-2 rounded-l-lg">Total (√ó ${data.parts} part${data.parts > 1 ? 's' : ''})</td>
                    <td class="py-2 text-right"></td>
                    <td class="py-2 text-right"></td>
                    <td class="py-2 text-right text-brand-600 rounded-r-lg">${formatMoney(data.taxBeforeDons)}</td>
                </tr>
            `;

            // Dynamic tip
            updateTip(data);
        }

        function updateTip(data) {
            let tip = '';

            if (data.tax === 0) {
                tip = "Vous n'√™tes pas imposable. Pensez √† √©pargner via un Livret A ou LEP pour faire fructifier votre √©pargne.";
            } else if (!state.hasPer && data.marginalRate >= 0.30) {
                tip = `Avec un taux marginal de ${(data.marginalRate * 100).toFixed(0)}%, le PER serait tr√®s efficace pour vous. Chaque ‚Ç¨ vers√© vous ferait √©conomiser ${(data.marginalRate * 100).toFixed(0)} centimes d'imp√¥t.`;
            } else if (state.hasPer && data.perSavings > 0) {
                tip = `Excellent ! Votre PER vous fait √©conomiser ${formatMoney(data.perSavings)} d'imp√¥t. V√©rifiez votre plafond pour optimiser encore plus.`;
            } else if (data.marginalRate >= 0.30) {
                tip = `Votre taux marginal est de ${(data.marginalRate * 100).toFixed(0)}%. Pensez aux d√©ductions (PER, dons) pour r√©duire efficacement votre imp√¥t.`;
            } else {
                tip = "Pensez aux cr√©dits d'imp√¥t (garde d'enfants, emploi √† domicile) pour r√©duire votre facture fiscale.";
            }

            els.dynamicTip.textContent = tip;
        }

        // ============================================
        // URL MANAGEMENT
        // ============================================
        function updateURL() {
            const params = new URLSearchParams();
            params.set('status', state.status);
            params.set('children', state.children);
            if (state.parentIsole) params.set('isole', '1');
            params.set('income1', state.income1);
            if (state.status === 'married' && state.hasTwoIncomes) {
                params.set('income2', state.income2);
            }
            if (state.incomeFoncier > 0) params.set('foncier', state.incomeFoncier);
            params.set('year', state.year);
            if (state.hasPer) {
                params.set('per', state.perAmount);
                if (!state.perPlafondUnknown && state.perPlafond > 0) {
                    params.set('plafond', state.perPlafond);
                }
            }
            if (state.hasDons) {
                if (state.dons66 > 0) params.set('dons66', state.dons66);
                if (state.dons75 > 0) params.set('dons75', state.dons75);
            }

            const newUrl = window.location.pathname + '?' + params.toString();
            history.replaceState(null, '', newUrl);
        }

        function loadFromURL() {
            const params = new URLSearchParams(window.location.search);

            if (params.has('status')) {
                state.status = params.get('status');
                const radio = document.querySelector(`input[name="status"][value="${state.status}"]`);
                if (radio) radio.checked = true;
            }

            if (params.has('children')) {
                state.children = parseInt(params.get('children')) || 0;
                els.childCount.textContent = state.children;
            }

            if (params.has('isole')) {
                state.parentIsole = params.get('isole') === '1';
                els.parentIsole.checked = state.parentIsole;
            }

            if (params.has('income1')) {
                state.income1 = parseInt(params.get('income1')) || 40000;
                els.income1Input.value = state.income1;
                els.income1Slider.value = Math.min(state.income1, 200000);
            }

            if (params.has('income2')) {
                state.income2 = parseInt(params.get('income2')) || 0;
                state.hasTwoIncomes = true;
                els.hasTwoIncomes.checked = true;
                els.income2Input.value = state.income2;
                els.income2Slider.value = Math.min(state.income2, 200000);
            }

            if (params.has('foncier')) {
                state.incomeFoncier = parseInt(params.get('foncier')) || 0;
                els.incomeFoncier.value = state.incomeFoncier;
            }

            if (params.has('year')) {
                state.year = parseInt(params.get('year')) || 2025;
                els.selectYear.value = state.year;
            }

            if (params.has('per')) {
                state.hasPer = true;
                state.perAmount = parseInt(params.get('per')) || 0;
                els.hasPer.checked = true;
                els.perAmount.value = state.perAmount;
                els.perSlider.value = Math.min(state.perAmount, 30000);
                els.perDetails.classList.remove('hidden');

                if (params.has('plafond')) {
                    state.perPlafond = parseInt(params.get('plafond')) || 0;
                    els.perPlafond.value = state.perPlafond;
                }
            }

            if (params.has('dons66') || params.has('dons75')) {
                state.hasDons = true;
                els.hasDons.checked = true;
                els.donsDetails.classList.remove('hidden');

                if (params.has('dons66')) {
                    state.dons66 = parseInt(params.get('dons66')) || 0;
                    els.dons66.value = state.dons66;
                    els.dons66Slider.value = Math.min(state.dons66, 10000);
                }

                if (params.has('dons75')) {
                    state.dons75 = parseInt(params.get('dons75')) || 0;
                    els.dons75.value = state.dons75;
                    els.dons75Slider.value = Math.min(state.dons75, 2000);
                }
            }

            updateVisibility();
        }

        // ============================================
        // VISIBILITY
        // ============================================
        function updateVisibility() {
            // Two incomes toggle (only for married)
            if (state.status === 'married') {
                els.twoIncomesToggle.classList.remove('hidden');
                els.twoIncomesToggle.classList.add('flex');
            } else {
                els.twoIncomesToggle.classList.add('hidden');
                els.twoIncomesToggle.classList.remove('flex');
                state.hasTwoIncomes = false;
                els.hasTwoIncomes.checked = false;
            }

            // Income 2 container
            if (state.status === 'married' && state.hasTwoIncomes) {
                els.income2Container.classList.remove('hidden');
            } else {
                els.income2Container.classList.add('hidden');
            }

            // Parent isol√© (only for single/divorced)
            if (state.status === 'married') {
                els.parentIsoleContainer.classList.add('hidden');
                state.parentIsole = false;
                els.parentIsole.checked = false;
            } else {
                els.parentIsoleContainer.classList.remove('hidden');
            }

            // PER details
            if (state.hasPer) {
                els.perDetails.classList.remove('hidden');
            } else {
                els.perDetails.classList.add('hidden');
            }

            // PER plafond container
            if (state.perPlafondUnknown) {
                els.perPlafondContainer.classList.add('hidden');
            } else {
                els.perPlafondContainer.classList.remove('hidden');
            }

            // Dons details
            if (state.hasDons) {
                els.donsDetails.classList.remove('hidden');
            } else {
                els.donsDetails.classList.add('hidden');
            }
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        function setupEventListeners() {
            // Status
            els.statusRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    state.status = e.target.value;
                    updateVisibility();
                    calculate();
                });
            });

            // Children
            els.btnChildPlus.addEventListener('click', () => {
                if (state.children < 10) {
                    state.children++;
                    els.childCount.textContent = state.children;
                    calculate();
                }
            });

            els.btnChildMinus.addEventListener('click', () => {
                if (state.children > 0) {
                    state.children--;
                    els.childCount.textContent = state.children;
                    calculate();
                }
            });

            // Parent isol√©
            els.parentIsole.addEventListener('change', (e) => {
                state.parentIsole = e.target.checked;
                calculate();
            });

            // Year
            els.selectYear.addEventListener('change', (e) => {
                state.year = parseInt(e.target.value);
                calculate();
            });

            // Income 1
            const syncSlider = (input, slider, key, max = 200000) => {
                input.addEventListener('input', (e) => {
                    state[key] = parseInt(e.target.value) || 0;
                    slider.value = Math.min(state[key], max);
                    calculate();
                });
                slider.addEventListener('input', (e) => {
                    state[key] = parseInt(e.target.value);
                    input.value = state[key];
                    calculate();
                });
            };

            syncSlider(els.income1Input, els.income1Slider, 'income1');
            syncSlider(els.income2Input, els.income2Slider, 'income2');
            syncSlider(els.perAmount, els.perSlider, 'perAmount', 30000);

            // Two incomes toggle
            els.hasTwoIncomes.addEventListener('change', (e) => {
                state.hasTwoIncomes = e.target.checked;
                updateVisibility();
                calculate();
            });

            // Foncier
            els.incomeFoncier.addEventListener('input', (e) => {
                state.incomeFoncier = parseInt(e.target.value) || 0;
                calculate();
            });

            // PER toggle
            els.hasPer.addEventListener('change', (e) => {
                state.hasPer = e.target.checked;
                updateVisibility();
                calculate();
            });

            // PER plafond
            els.perPlafond.addEventListener('input', (e) => {
                state.perPlafond = parseInt(e.target.value) || 0;
                calculate();
            });

            // PER plafond unknown
            els.perPlafondUnknown.addEventListener('change', (e) => {
                state.perPlafondUnknown = e.target.checked;
                updateVisibility();
                calculate();
            });

            // Dons toggle
            els.hasDons.addEventListener('change', (e) => {
                state.hasDons = e.target.checked;
                updateVisibility();
                calculate();
            });

            // Dons 66%
            syncSlider(els.dons66, els.dons66Slider, 'dons66', 10000);

            // Dons 75%
            syncSlider(els.dons75, els.dons75Slider, 'dons75', 2000);

            // Reset
            els.btnReset.addEventListener('click', () => {
                window.location.href = window.location.pathname;
            });

            // Share
            els.btnShare.addEventListener('click', () => {
                els.shareUrl.value = window.location.href;
                els.shareModal.classList.remove('hidden');
            });

            els.closeModal.addEventListener('click', () => {
                els.shareModal.classList.add('hidden');
            });

            els.shareModal.addEventListener('click', (e) => {
                if (e.target === els.shareModal) {
                    els.shareModal.classList.add('hidden');
                }
            });

            els.copyUrl.addEventListener('click', () => {
                els.shareUrl.select();
                document.execCommand('copy');
                els.copySuccess.classList.remove('hidden');
                setTimeout(() => els.copySuccess.classList.add('hidden'), 2000);
            });

            // Mobile results button
            els.mobileResultsBtn.addEventListener('click', () => {
                document.querySelector('#simulateur').scrollIntoView({ behavior: 'smooth', block: 'start' });
                setTimeout(() => {
                    document.querySelector('.lg\\:col-span-5').scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            });
        }

        // ============================================
        // INIT
        // ============================================
        function init() {
            lucide.createIcons();
            loadFromURL();
            setupEventListeners();
            calculate();
        }

        // Run
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    })();
    </script>

</body></html>
